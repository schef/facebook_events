from selenium.webdriver import Chrome
from selenium.webdriver.chrome.options import Options
from selenium.webdriver.common.by import By
from selenium.webdriver.support.wait import WebDriverWait
import re


import credentials

def get_driver(headless=True):
    opts = Options()
    if headless:
        opts.add_argument("-headless")
    opts.add_argument("--disable-notifications")
    return Chrome(options=opts)

def get_web_element_attribute_names(web_element):
    """Get all attribute names of a web element"""
    # get element html
    html = web_element.get_attribute("outerHTML")
    # find all with regex
    pattern = """([a-z]+-?[a-z]+_?)='?"?"""
    return re.findall(pattern, html)

def print_element(element):
    #print(element)
    print(f"  tag_name[{element.tag_name}]")
    print(f"  attributes[{element.get_attributes()}]")
    #print(f"  text[{element.text}]")
    #for a in get_web_element_attribute_names(element):
    #    print(f"  {a}[{element.get_attribute(a)}]")
    #for a in get_web_element_attribute_names(element):
    #    print(f"  {a}[{element.get_attribute(a)}]")

def accept_cookies(driver):
    print("accept_cookies start")
    driver.get("https://www.facebook.com")
    search_text = "Allow essential and optional cookies"
    WebDriverWait(driver.find_element(by=By.XPATH, value="//button"), 10, 1, None).until(lambda x: search_text in x.text, "Cookies not found")
    buttons = driver.find_elements(By.XPATH, "//button")
    for button in buttons:
        if search_text in button.text:
            button.click()
    print("accept_cookies end")

def login(driver, email, password):
    print("login start")
    driver.get("https://www.facebook.com/login")
    driver.find_element(By.ID, "email").send_keys(email)
    driver.find_element(By.ID, "pass").send_keys(password)
    driver.find_element(By.TAG_NAME, "form").submit()
    print("login end")

def load_events(driver):
    print("load_events start")
    driver.get("https://www.facebook.com/events/search/?q=%C4%8Cakovec")
    print("load_events end")

def read_events(driver):
    print("read_events start")
    found = WebDriverWait(driver.find_element(by=By.XPATH, value="//div[@role = 'feed']"), 10, 1, None).until(lambda x: len(x.text) > 0, "Feed not found")
    if found:
        links = driver.find_elements(by=By.XPATH, value="//a[@role = 'link' and boolean(@link)]")
        print(links)
        #for link in links:
        #    for attr in link.get_property('attributes'):
        #        print(attr)
    print("read_events end")


if __name__ == "__main__":
    driver = get_driver(headless=False)
    accept_cookies(driver)
    login(driver, credentials.mail, credentials.password)
    #load_events(driver)
    #read_events(driver)
